
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Openerp Dev Notes (3). Objects Fields And Methods</title>
	<meta name="author" content="Jianhua Zhang">
	<link href='/assets/themes/the-program/css/style.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/" rel="alternate" title="Openerp Dev Notes (3). Objects Fields And Methods" type="application/atom+xml">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
</head>
<body>

<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
					<ul>
						<li class="logo"><a href="/">两招</a></li>
						<li class="archive"><a href="/archive.html">archive</a></li>
						<li class="page"><a href="/pages.html">pages</a></li>
						<li class="category"><a href="/categories.html">categories</a></li>
						<li class="tag"><a href="/tags.html">tags</a></li>
						<li class="forkme"><div><iframe src="http://markdotto.github.com/github-buttons/github-btn.html?user=plusjade&repo=jekyll-bootstrap&type=fork&count=true"
									allowtransparency="true" frameborder="0" scrolling="0" width="95px" height="20px"></iframe></div></li>
					</ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					
<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">Openerp Dev Notes (3). Objects Fields And Methods</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
					
<h2 id="modules">1.3 Modules</h2>

<h3 id="section">1.3.2 对象, 字段和方法</h3>

<h3 id="openerp-objects">OpenERP Objects</h3>

<p>OpenERP中, 所有数据资源通过objects来访问.</p>

<p>注意, 每一类资源对应一个object, 而不是每个资源对应一个对象. 例如, res.partner管理所有的partner, 而不是一个partner对应一个res.partner. 用OO的话来说, 一个object是一个类而不是一个对象.</p>

<p>这样, 对象的每个方法有一个”ids”参数, 用来确定这个方法应用到的资源.</p>

<p>例如, 如果两个partner, id分别为1和5, 那么向他们发送email的方法”send_email”方法应该这样调用:</p>

<pre><code>res_partner.send_email(..., [1,5], ...)
</code></pre>

<p>对于开发者来说:</p>

<ul>
  <li>OpenERP的”objects”对应OO中的类</li>
  <li>一个OpenERP的”resource”对应OO中的类的实例</li>
</ul>

<p>一个OpenERP的”resource”可以通过”browser”类方法(OpenERP的对象方法)转换为一个Python对象.</p>

<h3 id="orm">ORM</h3>

<p>OpenERP中, ORM为objects和PostgreSQL中的数据架起一座桥梁.</p>

<h3 id="openerp">OpenERP对象属性</h3>

<h4 id="section-1">对象介绍</h4>

<p>为了定一个新的对象, 必须定义一个新的Python类并实例化它, 这个类必须派生自osv类(osv module中).</p>

<h4 id="section-2">对象定义</h4>

<p>使用一些预定义名称的域来定义对象, 其中两个是必须的(_name和_columns), 其他是可选的.</p>

<h4 id="section-3">预定义域</h4>

<p><strong>_auto</strong>: 确定是否根据对象自动创建PostgreSQL表. 例如, 当处理由PostgreSQL的视图产生的对象时, 将此域设置为False. 查看”从PostgreSQL视图生成报表”获得更多信息.</p>

<p><strong>_columns(必需)</strong>: 对象字段定义, 查看”字段”部分获取更多信息.</p>

<p><strong>_constraints</strong>: 对象约束, 查看”约束”部分获取更多信息.</p>

<p><strong>_sql_constraints</strong>: 对象的SQL约束, 查看”SQL约束”部分获取更多信息.</p>

<p><strong>_default</strong>: 对象一些字段的默认值.</p>

<p><strong>_inherit</strong>: 当前对象派生自的osv对象的名字. 查看”对象继承”部分获取更多信息.</p>

<p><strong>_inherits</strong>: 当前对象派生自的osv对象列表, 这个列表必需是一个下列形式的python字典: {‘name_of_the_parent_object’: ‘name_of_the_field’, …}, 默认值为{}. 查看”对象继承”部分获取更多信息.</p>

<p><strong>_log_access</strong>: 确定资源写操作是否记入日志. 如果为true, 四个字段将会添加到表中: create_uid, create_date, write_uid, write_date. 这些字段用于保存记录的创建人id和时间, 以及修改人id和时间. 这些数据可以通过perm_read方法获得.</p>

<p><strong>_name(必需)</strong>: 对象名, 默认值: None.</p>

<p><strong>_order</strong>: 用于排序检索或读方法结果的fields. 默认值: ‘id’. 示例:</p>

<pre><code>_order = "name"
_order = "date_order desc"
</code></pre>

<p><strong>_rec_name</strong>: 资源名所保存的字段名, 默认值为:’name’. 注意, 默认情况下”name_get”方法简单地返回这个字段的内容.</p>

<p><strong>_sequence</strong>: 管理对象ids的SQL序列名称, 默认值: None.</p>

<p><strong>_sql</strong>: 对象创建时执行的sql代码, 只有_auto设置为True有效. 当表创建后这段代码将被执行.</p>

<p><strong>_table</strong>: SQL表名, 默认值为_name域的值(用下划线’_‘替换_name中的’.’)</p>

<h4 id="inherit">对象继承 - _inherit</h4>

<p>添加/修改对象的字段, 用继承挺好.</p>

<h4 id="section-4">扩展一个对象</h4>

<p>两种方式, 每种都创建一类新的数据, 新的数据保持了原有的字段和行为并且具有了新的字段和行为, 但是这两种方法的后续编程方法有很大的不同.</p>

<p>示例1创建一个新的子类”custom_material”, 它可以被处理”network.material”的view或tree看到或使用, 示例2与此不同.</p>

<p>示例1:</p>

<pre><code>class custom_material(osv.osv):
    _name = ’network.material’
    _inherit = ’network.material’
    _columns = {
        ’manuf_warranty’: fields.boolean(’Manufacturer warranty?’),
    }
    _defaults = {
        ’manuf_warranty’: lambda *a: False,
    }

custom_material()
</code></pre>

<p><strong>示例1注意: _name == _inherit</strong></p>

<p>示例1中, ‘curtom_material’相比与’network.material’新增了一个字段’manuf_warranty’. 新的类实例能够被能处理”network.material”的view或tree识别.</p>

<p>这种继承在OO中被称为”类继承”, 子类继承了父类的数据(fields)和行为(functions).</p>

<p>示例2:</p>

<pre><code>class other_material(osv.osv):
    _name = ’other.material’
    _inherit = ’network.material’
    _columns = {
            ’manuf_warranty’: fields.boolean(’Manufacturer warranty?’),
    }
    _defaults = {
        ’manuf_warranty’: lambda *a: False,
    }

other_material()
</code></pre>

<p><strong>示例2注意: _name != _inherit</strong></p>

<p>示例2中, ‘other_material’保留所有’network.material’的字段, 并且增加了一个新的字段’manuf_warranty’. 所有这些字段是’other.material’表的一部分. 这个类的新实例不能被’network.material’表上的view和tree识别.</p>

<p>这种继承被称为”原型继承”(Javascript就是这种继承), 因为新创建的子类从父类(原型prototype)拷贝了所有字段. 子类继承了其父类的所有数据和行为.</p>

<h4 id="section-5">委托继承</h4>

<p>语法:</p>

<pre><code>class tiny_object(osv.osv)
    _name = ’tiny.object’
    _table = ’tiny_object’
    _inherits = {
        ’tiny.object_a’: ’object_a_id’,
        ’tiny.object_b’: ’object_b_id’,
        ... ,
        ’tiny.object_n’: ’object_n_id’
    }
    (...)
</code></pre>

<p>对象tiny_object从n个对象(tiny.object_a, tiny.object_b,…,tiny.object_n)继承了所有的列以及所有的方法.</p>

<p>为了从多个表继承, 每个被继承的对象在tiny_object表中增加一列, 该列保存一个外键. object_a_id, object_b_id,…,object_n_id是类型字符串, 并且确定了外键列的标题, 外键列保存从tiny.object_a, tiny.object_b,…,tiny.object_n而来的外键.</p>

<p>这种继承机制被称为实例继承或值继承, 一个资源(实例)具有其parents的VALUES.</p>

<h4 id="section-6">字段介绍</h4>

<p>对象包含不同类型的字段, 可以分为三类: 简单类型, 关系类型和函数字段. 简单类型是整形, 浮点, boolean, 字符串等; 关系类型用于表示对象间的关系, 例如one2one, one2many, many2one等. 函数字段是特殊的字段, 因为它们并不保存在数据库中, 而是在使用时由其他字段实时计算得到他们的值.</p>

<p>OpenERP的类初始化代码(__init__()):</p>

<pre><code>def __init__(self, string=’unknown’, required=False, readonly=False,
             domain=None, context="", states=None, priority=0, change_default=False, size=None,
             ondelete="set null", translate=False, select=False, **args) :
</code></pre>

<p>可选参数列表如下:</p>

<ul>
  <li>change_default: 这个字段的值决定用户是否可以为其他字段的默认值. 默认值需要定义在ir.values表中.</li>
  <li>help: 一段说明字段如何使用的文本描述, 当鼠标滑过字段上方时, 这些文字将在tooltip显示出来.</li>
  <li>ondelete: 删除时如何处理相关的记录, 允许的值为: restrict, no action, cascade, set null, set default.</li>
  <li>priority: Not used?</li>
  <li>readonly: 该字段是否只读, 也即不能编辑.</li>
  <li>required: 是否必须.</li>
  <li>size: number characters or digits.</li>
  <li>states:</li>
  <li>string: 显示在标签或列头的文本. 如果包含非ASCII字符, 那么必须用python的unicode字符串. 例如: fields.boolean(u’测试’).</li>
  <li>translate: 布尔值, 指示该字段是否翻译.</li>
</ul>

<p>其他一些可选的参数:</p>

<ul>
  <li>context:</li>
  <li>domain:</li>
  <li>invisible: 在forms上隐藏字段值, 例如密码.</li>
  <li>on_change:</li>
  <li>relation:</li>
  <li>select:</li>
</ul>

<h3 id="section-7">字段类型</h3>

<h4 id="section-8">基本类型</h4>

<p><strong>boolean</strong>:</p>

<pre><code>fields.boolean(’Field Name’ [, Optional Parameters]),
</code></pre>

<p><strong>integer</strong>:</p>

<pre><code>fields.integer(’Field Name’ [, Optional Parameters]),
</code></pre>

<p><strong>float</strong>:</p>

<pre><code>fields.float(’Field Name’ [, Optional Parameters]),
</code></pre>

<blockquote>
  <p>注意: 可选参数digits定义数字的精度(包括小数点前后总有效位数)和小数位数(小数点后位数). 如果此参数没有定义, 此字段是一个双精度浮点数. 警告: 浮点数字可能是不准确的, 会导致误差, 所以对于金额之类的精确数字, 应该定义参数.</p>
</blockquote>

<p><strong>char</strong>:</p>

<pre><code>fields.char(
        ’Field Name’,
        size=n [,
        Optional Parameters]), # where ’’n’’ is an integer.

示例: ’city’ : fields.char(’City Name’, size=30, required=True),
</code></pre>

<p><strong>text</strong>:</p>

<pre><code>fields.text(’Field Name’ [, Optional Parameters]),
</code></pre>

<p><strong>date</strong>:</p>

<pre><code>fields.date(’Field Name’ [, Optional Parameters]),
</code></pre>

<p><strong>datetime</strong>:</p>

<pre><code>fields.datetime(’Field Name’ [, Optional Parameters]),
</code></pre>

<p><strong>binary</strong>: 二进制链</p>

<p><strong>selection</strong>: 一个允许用户在一些预定义值中选择的字段</p>

<pre><code>fields.selection(((’n’,’Unconfirmed’), (’c’,’Confirmed’)),
               ’Field Name’ [, Optional Parameters]),
</code></pre>

<blockquote>
  <p>注意: 参数格式为: 字符串元组的元组
((’key_or_value’, ’string_to_display’), … )</p>
</blockquote>

<blockquote>
  <p>注意: 也可以指定一个用来返回元组的函数, 例如</p>
</blockquote>

<pre><code>def _get_selection(self, cursor, user_id, context=None): return (
       (’choice1’, ’This is the choice 1’),
       (’choice2’, ’This is the choice 2’))
_columns = {
   ’sel’ : fields.selection(
}
</code></pre>

<p><strong>示例</strong>: 在selection使用many2one的关系字段, 字段定义中添加以下内容:</p>

<pre><code>...,
’my_field’: fields.many2one(
        ’mymodule.relation.model’,
        ’Title’,
        selection=_sel_func),
...,
</code></pre>

<p>其中_sel_func定义为:</p>

<pre><code>def _sel_func(self, cr, uid, context=None):
    obj = self.pool.get(’mymodule.relation.model’)
    ids = obj.search(cr, uid, [])
    res = obj.read(cr, uid, ids, [’name’, ’id’], context) res = [(r[’id’], r[’name’]) for r in res]
    return res
</code></pre>

<h3 id="section-9">关系类型</h3>

<p><strong>one2one</strong>: 表示两个对象间1对一的关系, 现在已经不再使用, 用many2one代替之.</p>

<pre><code>fields.one2one(’other.object.name’, ’Field Name’)
</code></pre>

<p><strong>many2one</strong>: 对象通过这个字段关联父对象, 例如, 员工与所属部门是多对一关系, 多个员工属于一个部门.</p>

<pre><code>fields.many2one(
        ’other.object.name’,
        ’Field Name’,
        optional parameters)
</code></pre>

<p>可选参数:</p>

<ul>
  <li>ondelete: 当字段对应的资源被删时做什么, 可以选择的操作: 预定义值(cascade, set null, restrict, no action set default)和默认值(set null)</li>
  <li>required: 是否必填</li>
  <li>readonly: 是否只读</li>
  <li>select: 在外键字段创建一个索引</li>
</ul>

<p>示例:</p>

<pre><code>’commercial’: fields.many2one(
        ’res.users’,
        ’Commercial’,
        ondelete=’cascade’),
</code></pre>

<p><strong>one2many</strong>:</p>

<pre><code>fields.one2many(
        ’other.object.name’,
        ’Field relation id’,
        ’Fieldname’,
        optional parameter)
</code></pre>

<p>可选参数:</p>

<ul>
  <li>invisible:</li>
  <li>states:</li>
  <li>readonly:</li>
</ul>

<p>示例:</p>

<pre><code>’address’: fields.one2many(
        ’res.partner.address’,
        ’partner_id’,
        ’Contacts’),
</code></pre>

<p><strong>many2many</strong>:</p>

<pre><code>fields.many2many(’other.object.name’,
                 ’relation object’,
                 ’actual.object.id’,
                 ’other.object.id’,
                 ’Field Name’)
</code></pre>

<p>其中:</p>

<ul>
  <li>other.object.name是属于这个关联关系的另一个对象</li>
  <li>relation object是关联表</li>
  <li>actual.object.id和other.object.id是关联表中的字段名</li>
</ul>

<p>示例:</p>

<pre><code>’category_ids’:
   fields.many2many(
    ’res.partner.category’,
    ’res_partner_category_rel’,
    ’partner_id’,
    ’category_id’,
    ’Categories’),
</code></pre>

<p>为了双向访问(也即在另一个对象中创建一个字段):</p>

<pre><code>class other_object_name2(osv.osv):
    _inherit = ’other.object.name’
    _columns = {
        ’other_fields’: fields.many2many(
            ’actual.object.name’,
            ’relation object’,
            ’actual.object.id’,
            ’other.object.id’,
            ’Other Field Name’),
other_object_name2()
</code></pre>

<p>示例:</p>

<pre><code>class res_partner_category2(osv.osv):
    _inherit = ’res.partner.category’
    _columns = {
        ’partner_ids’: fields.many2many(
            ’res.partner’,
            ’res_partner_category_rel’,
            ’category_id’,
            ’partner_id’,
            ’Partners’),
    }
res_partner_category2()
</code></pre>

<p><strong>related</strong>: 有时需要引用关系的关系. 例如, 假设有城市-&gt;省-&gt;国家的关系, 如果需要从城市引用国家, 那么就需要在城市对象上定义一个字段, 如下:</p>

<pre><code>’country_id’: fields.related(
    ’state_id’,
    ’country_id’,
    type="many2one",
    relation="res.country",
    string="Country",
    store=False)
</code></pre>

<p>其中:</p>

<ul>
  <li>第一组参数是字段的引用链, 引用链的最后是希望引用的字段.</li>
  <li>type是希望引用的字段的类型</li>
  <li>如果希望字段仍然是某种引用, 那就使用relation. relation用于查询表中引用.</li>
</ul>

<h3 id="section-10">函数字段</h3>


					<div class="meta">
						<p class="date-publish">
							Published: 
							<date class="date-pub" title="2014-04-22T00:00:00+08:00" datetime="2014-04-22T00:00:00+08:00" pubdate>
							<span class="month"><abbr>April</abbr></span>
							<span class="day">22</span>
							<span class="year">2014</span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							


  
     
    	<li><a href="/categories.html#openerp-ref">
    		openerp <span>15</span>
    	</a></li>
    
  


						</ul>
						<ul class="list-tag list-linear">
							<li class="list-head">tags: </li>
							
							


  
     
    	<li><a href="/tags.html#Python-ref">Python <span>15</span></a></li>
     
    	<li><a href="/tags.html#OpenERP-ref">OpenERP <span>15</span></a></li>
    
  



						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					<div class="social">
						<ul class="list-linear">
							<li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="jeffzhangfly" data-lang="en">Tweet</a></div></li>
							<li><div class="twitter-follow"><a href="https://twitter.com/jeffzhangfly" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
						</ul>
					</div>
					<div class="comment">
					


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jeffzhangfly'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




					</div>
				</div><!-- misc-content -->
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/openerp/2014/04/03/OpenERP-DEV-Notes-%282%29.-Modules-structure" title="View Openerp Dev Notes (2). Modules Structure">&laquo; Openerp Dev Notes (2). Modules Structure</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/openerp/2014/04/22/OpenERP-DEV-Notes-%28x%29.-Tutorial" title="View Openerp Dev Notes (x). Tutorial">Openerp Dev Notes (x). Tutorial &raquo;</a></li>
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>About</h4>
					<ul>
            <!-- <li class="contact"><address><span class="author fn n">Jianhua Zhang</span> - <span class="fn email"></span></address></li> -->
						<li class="github"><a href="http://github.com/jeffzhangfly/" rel="me">github.com/jeffzhangfly</a></li>
						<li class="twitter"><a href="http://twitter.com/jeffzhangfly/" rel="me">twitter.com/jeffzhangfly</a></li>
						<li class="rss"><a href="http://feeds.feedburner.com/">Subscribe to RSS Feed</a></li>
					</ul>
				</div><!-- misc -->
				<p class="licence">
        <!-- Theme: <a href="http://layouts-the.me">the_minimum</a> based on <a href="http://jekyllbootstrap.com/">Jekyll-bootstrap</a>.<br> -->
        <!-- Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a>. -->
					© 2014 Jianhua Zhang
				</p>
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/openerp/2014/04/22/OpenERP-DEV-Notes-%283%29.-Objects-Fields-and-Methods" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>

  
</body>
</html>

